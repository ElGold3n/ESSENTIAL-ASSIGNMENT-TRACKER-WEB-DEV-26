<!--
  Essential Assignment Tracker - Home Page

  This web page lets you view, add, edit, and delete assignments.

  It uses HTML for structure, CSS for styling, and JavaScript for logic and interactivity.
-->
<!--
    Main styles for the home page can be found in css/index.css for maintainability and clarity.

    Toast notification styles are inlined for functionality.
-->
<link rel="stylesheet" href="css/index.css">

<!-- Toast notification styles for pop-up messages -->
<style id="toastStyles">
    .toast-notification {
        position: fixed;
        bottom: 32px;
        right: 32px;
        min-width: 320px;
        max-width: 360px;
        background: #23263a;
        color: #e0e0e0;
        border-radius: 10px;
        box-shadow: 0 4px 24px rgba(0,0,0,0.18), 0 1.5px 0 #38b6ff;
        padding: 18px 24px 18px 56px;
        font-size: 1rem;
        font-family: Segoe UI, Arial, sans-serif;
        z-index: 9999;
        opacity: 0;
        pointer-events: none;
        display: flex;
        align-items: center;
        gap: 16px;
        transition: opacity 0.4s, transform 0.4s;
        transform: translateY(40px);
    }
    .toast-notification.visible {
        opacity: 1;
        pointer-events: auto;
        transform: translateY(0);
    }
    .toast-icon {
        position: absolute;
        left: 20px;
        top: 50%;
        transform: translateY(-50%);
        width: 28px;
        height: 28px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .toast-close {
        margin-left: auto;
        background: none;
        border: none;
        color: #e0e0e0;
        font-size: 1.2rem;
        cursor: pointer;
        opacity: 0.7;
        transition: opacity 0.2s;
    }
    .toast-close:hover {
        opacity: 1;
    }
    .dark-mode .toast-notification {
        background: #23263a;
        color: #e0e0e0;
    }
    .toast-notification {
        background: #f8f9fa;
        color: #23263a;
    }
    .dark-mode .toast-notification {
        background: #23263a;
        color: #e0e0e0;
    }
</style>
</head>
<body>

<!-- Toast notification container for pop-up messages -->

<div id="toastContainer" style="position:fixed;z-index:9999;pointer-events:none;"></div>

<!-- Top navigation bar -->

<div class="header">
    <h1>üéì Essential Assignment Tracker

        <!-- Dark mode toggle button with sun/moon icons -->

        <button id="darkModeToggle" aria-label="Toggle dark mode" style="background:none;border:none;cursor:pointer;margin-left:12px;vertical-align:middle;outline:none;position:relative;">
            <span id="darkModeIcon" style="display:inline-block;width:32px;height:32px;vertical-align:middle;">

                <!-- Sun SVG for light mode -->
                <svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="32" height="32" style="display:block;">
                    <circle cx="24" cy="24" r="10" fill="#ffe066" stroke="#f9c846" stroke-width="2"/>
                    <g stroke="#f9c846" stroke-width="2">
                        <line x1="24" y1="4" x2="24" y2="12"/>
                        <line x1="24" y1="36" x2="24" y2="44"/>
                        <line x1="4" y1="24" x2="12" y2="24"/>
                        <line x1="36" y1="24" x2="44" y2="24"/>
                        <line x1="10.93" y1="10.93" x2="16.97" y2="16.97"/>
                        <line x1="31.03" y1="31.03" x2="37.07" y2="37.07"/>
                        <line x1="10.93" y1="37.07" x2="16.97" y2="31.03"/>
                        <line x1="31.03" y1="16.97" x2="37.07" y2="10.93"/>
                    </g>
                </svg>
                <!-- Moon SVG for dark mode -->

                <svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="32" height="32" style="display:none;">
                    <path d="M34 24c0 7-5.5 12-12 12-2.5 0-4.8-0.7-6.7-2 6.2-1.1 10.7-6.2 10.7-12.1 0-3.2-1.2-6.1-3.2-8.3C25.2 13.2 34 15.7 34 24z" fill="#b411cf" stroke="#fff" stroke-width="2"/>
                    <circle cx="30" cy="20" r="2" fill="#fff" opacity="0.7"/>
                    <circle cx="26" cy="28" r="1.2" fill="#fff" opacity="0.5"/>
                </svg>
            </span>
            <span style="position:absolute;top:40px;left:0;width:180px;background:#23263a;color:#e0e0e0;font-size:0.92rem;padding:6px 12px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.12);display:none;z-index:100;" id="darkModeHint">Toggle dark mode for easier viewing</span>
        </button>
        <script>
            // Show hint on hover

            const darkModeToggleBtn = document.getElementById('darkModeToggle');
            const darkModeHint = document.getElementById('darkModeHint');
            darkModeToggleBtn.addEventListener('mouseenter',()=>{darkModeHint.style.display='block';});
            darkModeToggleBtn.addEventListener('mouseleave',()=>{darkModeHint.style.display='none';});
        </script>
    </h1>

    <!-- Navigation menu links -->

    <div class="nav">
        <a href="index.html">üè† Home</a>
        <a href="add-Assignment.html">‚ûï Add Assignment</a>
        <a href="overview.html">üìä Overview</a>
        <a href="About.html">‚ÑπÔ∏è About</a>
    </div>
</div>
<!-- Main page content -->

<div class="content">
    
    <!-- Counter cards showing a quick overview -->

    <div class="stats" id="stats">

        <!-- Cards will be rendered by JS -->
    </div>
    <h2>Upcoming Assignments</h2>

    <!-- Search and filter options for Assignments -->
     
    <div class="controls">
        <input type="text" id="searchInput" placeholder="Search Assignments..." />
        <select id="moduleFilter">
            <option value="">Module ‚ñº</option>
            <option value="SET08801">SET08801</option>
            <option value="SET08825">SET08825</option>
            <option value="SET09801">SET09801</option>
            <option value="SET09901">SET09901</option>
        </select>
        <select id="statusFilter">
            <option value="">Status ‚ñº</option>
            <option value="Due soon">Due Soon</option>
            <option value="Overdue">Overdue</option>
            <option value="Completed">Completed</option>
            <option value="Active">Active</option>
        </select>
    </div>

    <!-- Assignment table -->

    <table>
        <thead>
        <tr>
            <th>Assignment</th>
            <th>Module</th>
            <th>Due Date</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody id="assignmentTable">

            <!-- Assignment rows rendered by JS -->
        </tbody>
    </table>

    <!-- Button to navigate to the add Assignment page and Delete Assignment button -->

        <div style="display: flex; gap: 12px; margin-top: 25px;">
                <a href="add-Assignment.html" class="add-btn" id="addAssignmentBtn">+ Add New Assignment</a>
                <button id="deleteAssignmentBtn" class="add-btn" style="background:#dc3545;" disabled>üóëÔ∏è Delete Assignment</button>
        </div>
        <style>
        .smoke-effect {
            position: absolute;
            pointer-events: none;
            border-radius: 50%;
            filter: blur(16px);
            opacity: 0.45;
            z-index: 1000;
            transition: opacity 0.5s;
            will-change: transform, opacity;
        }
        </style>
        <script>

        // Smoke effect for add and delete buttons

        function addSmokeEffect(btn, color) {
            let smoke = null;
            let fadeTimeout = null;
            btn.addEventListener('mouseenter', e => {
                if (!smoke) {
                    smoke = document.createElement('div');
                    smoke.className = 'smoke-effect';
                    smoke.style.background = color;
                    smoke.style.width = '60px';
                    smoke.style.height = '60px';
                    smoke.style.opacity = '0.45';
                    document.body.appendChild(smoke);
                }
                smoke.style.display = 'block';
            });
            btn.addEventListener('mousemove', e => {
                if (!smoke) return;
                const rect = btn.getBoundingClientRect();
                const x = e.clientX - 30;
                const y = e.clientY - 30;
                smoke.style.left = x + 'px';
                smoke.style.top = y + 'px';
                smoke.style.opacity = '0.45';
                smoke.style.transition = 'opacity 0.1s';
                if (fadeTimeout) clearTimeout(fadeTimeout);
            });
            btn.addEventListener('mouseleave', e => {
                if (smoke) {
                    smoke.style.transition = 'opacity 0.5s';
                    smoke.style.opacity = '0';
                    fadeTimeout = setTimeout(() => { if (smoke) smoke.style.display = 'none'; }, 500);
                }
            });
        }
        window.addEventListener('DOMContentLoaded', function() {
            const addBtn = document.getElementById('addAssignmentBtn');
            const delBtn = document.getElementById('deleteAssignmentBtn');
            if (addBtn) addSmokeEffect(addBtn, 'radial-gradient(circle at 50% 50%, #28a745 0%, #38b6ff 100%)');
            if (delBtn) addSmokeEffect(delBtn, 'radial-gradient(circle at 50% 50%, #b411cf 0%, #dc3545 100%)');
        });
        </script>
</div>
<script>
// Toast notification logic (shows pop-up messages)
// This function displays a notification at the bottom right of the page.
// It uses SVG icons for info and check marks, and auto-hides after normal system nofication duration (3.5s).

function showNotification(message, options = {}) {

    // Get the container for toast notifications

    const toastContainer = document.getElementById('toastContainer');

    // Remove any existing toast

    toastContainer.innerHTML = '';

    // Choose the icon SVG based on the type (check/info)

    const iconSVG = options.icon === 'check' ?
        `<svg width="28" height="28" viewBox="0 0 28 28" fill="none"><circle cx="14" cy="14" r="14" fill="#38b6ff"/><path d="M8 14.5l4 4 8-8" stroke="#fff" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg>` :
        `<svg width="28" height="28" viewBox="0 0 28 28" fill="none"><circle cx="14" cy="14" r="14" fill="#38b6ff"/><path d="M14 8v8" stroke="#fff" stroke-width="2.5" stroke-linecap="round"/><circle cx="14" cy="20" r="1.5" fill="#fff"/></svg>`;

    // Create the toast HTML

    const toast = document.createElement('div');
    toast.className = 'toast-notification';
    toast.innerHTML = `
        <span class="toast-icon">${iconSVG}</span>
        <span>${message}</span>
        <button class="toast-close" aria-label="Close notification">&times;</button>
    `;
    // Add close button logic

    toast.querySelector('.toast-close').onclick = () => {
        toast.classList.remove('visible');
        setTimeout(() => toast.remove(), 400);
    };
    toastContainer.appendChild(toast);

    // Show the toast with animation

    setTimeout(() => toast.classList.add('visible'), 10);

    // Auto-hide after 3.5s

    setTimeout(() => {
        toast.classList.remove('visible');
        setTimeout(() => toast.remove(), 400);
    }, options.duration || 3500);
}

// Get all assignments from localStorage, marking overdue ones

function getAssignments() {

    // Try to load assignments from localStorage

    const data = localStorage.getItem('assignments');
    let arr = data ? JSON.parse(data) : [];
    
    // Mark overdue assignments

    const today = new Date();
    today.setHours(0,0,0,0);
    arr = arr.map(a => {
        if (a.status !== 'Completed' && a.due) {
            let dueDate;

            // Parse date reliably from MM/DD/YYYY or other formats
            // This section ensures that assignment due dates are correctly interpreted
            // regardless of how the user enters them (e.g., 2026-02-25, 25/02/2026, or Mar 2, 2026).
            // It tries multiple parsing strategies so the stats and sorting are always accurate.

            dueDate = new Date(a.due);
            if (isNaN(dueDate)) {

                // Try parsing as 'MMM DD, YYYY' (e.g., Mar 2, 2026)
                dueDate = new Date(Date.parse(a.due));
            }
            dueDate.setHours(0,0,0,0);

            // If due date is before today, mark as overdue
            if (dueDate < today) a.status = 'Overdue';
        }


        if (isNaN(dueDate)) {
            // Try parsing as 'MMM DD, YYYY' (e.g., Mar 2, 2026)
            dueDate = new Date(Date.parse(a.due));
        }
        if (a.status === "Completed") completed++;
        else if (a.status === "Overdue") overdue++;
        if (dueDate.toDateString() === today.toDateString()) dueToday++;

        // Check if due this week (today through coming Sunday)

        const weekStart = new Date(today);
        weekStart.setHours(0,0,0,0);
        const weekEnd = new Date(today);
        weekEnd.setDate(today.getDate() + (7 - today.getDay() - 1)); // End of current week (Sunday)
        weekEnd.setHours(23,59,59,999);
        if (dueDate >= weekStart && dueDate <= weekEnd) thisWeek++;
    });
    // function: returns SVG for stat circle

    // If value is 0, the circle is invisible (hidden)

    // If value is nonzero, the circle is visible and animated

    function getStatCircle(val, color) {

        // If stat value is zero, hide the circle
        if (val === 0) {
            return `<svg width="70" height="70" style="visibility:hidden"><circle cx="35" cy="35" r="32" stroke="${color}" stroke-width="6" fill="none" /></svg>`;
        } else {
            // If stat value is nonzero, show and animate the circle
            
            return `<svg width="70" height="70"><circle cx="35" cy="35" r="32" stroke="${color}" stroke-width="6" fill="none" class="stat-anim" /></svg>`;
        }
    }

    // Render stat cards with animated/invisible circles
    document.getElementById('stats').innerHTML = `
        <div class="card">
            <h3>Due Today</h3>
            <div class="stat-circle">
                ${getStatCircle(dueToday, '#fd7e14')}
                <span class="number due-soon">${dueToday}</span>
            </div>
        </div>
        <div class="card">
            <h3>Overdue</h3>
            <div class="stat-circle">
                ${getStatCircle(overdue, '#dc3545')}
                <span class="number overdue">${overdue}</span>
            </div>
        </div>
        <div class="card">
            <h3>This Week</h3>
            <div class="stat-circle">
                ${getStatCircle(thisWeek, '#0385b8')}
                <span class="number active">${thisWeek}</span>
            </div>
        </div>
        <div class="card">
            <h3>Completed</h3>
            <div class="stat-circle">
                ${getStatCircle(completed, '#28a745')}
                <span class="number completed">${completed}</span>
            </div>
        </div>
    `;
}

// Render the assignments table

// This function displays all assignments in the table, with status badges and action buttons

function renderAssignments(assignments) {

    // Get the table body element where assignment rows will be added.

    const table = document.getElementById('assignmentTable');
    table.innerHTML = '';
    // Helper to map status to CSS class
    function getStatusClass(status) {
        switch (status) {
            case 'Completed': return 'status-Completed';
            case 'Overdue': return 'status-overdue';
            case 'Due soon': return 'status-due';
            case 'Active': return 'status-active';
            case 'Done': return 'status-done';
            case 'Normal': return 'status-normal';
            default: return 'status-normal';
        }
    }
    // Loop through assignments and add rows

    assignments.forEach((a, idx) => {
        let dateValue = '';
        const parsedDate = new Date(a.due);
        if (!isNaN(parsedDate)) {
            dateValue = parsedDate.toISOString().split('T')[0];
        }
        const statusClass = getStatusClass(a.status);
        table.innerHTML += `
            <tr class="assignment-row" data-idx="${idx}" tabindex="0" style="cursor:pointer;">
                <td>
                  ${a.name}
                  ${a.notes ? `<div class="notes-inline">${a.notes}</div>` : ''}
                  <button class="action-btn edit-btn" onclick="editAssignment(${idx});event.stopPropagation();" style="margin-top:4px;">Edit</button>
                </td>
                <td>${a.module}</td>
                <td>
                    <span>${a.due}</span><br>
                    <input type="date" value="${dateValue}" onchange="changeDueDate(${idx}, this.value);event.stopPropagation();" style="margin-top:4px;" />
                </td>
                <td><span class="status ${statusClass}">${a.status}</span></td>
                <td>
                    <select class="action-dropdown" onchange="updateStatus(${idx}, this.value);event.stopPropagation();">
                        <option value="Active" ${a.status === 'Active' ? 'selected' : ''}>Active</option>
                        <option value="Due soon" ${a.status === 'Due soon' ? 'selected' : ''}>Due Soon</option>
                        <option value="Completed" ${a.status === 'Completed' ? 'selected' : ''}>Completed</option>
                        <option value="Overdue" ${a.status === 'Overdue' ? 'selected' : ''}>Overdue</option>
                    </select>
                </td>
            </tr>
        `;
    });
}

// Edit assignment: opens the add-Assignment page with the assignment's index for editing

function editAssignment(idx) {
    window.location.href = `add-Assignment.html?edit=${idx}`;
}

// Change the due date for an assignment

function changeDueDate(idx, newDate) {

    // Get all assignments

    const assignments = getAssignments();

    // Format date for display

    const dateObj = new Date(newDate);
    const displayDate = dateObj.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
    assignments[idx].due = displayDate;
    saveAssignments(assignments);
    renderStats(assignments);
    renderAssignments(assignments);
    showNotification('Assignment due date updated!', { icon: 'check' });
}

// Update the status for an assignment when changed from the dropdown

function updateStatus(idx, status) {

    // Get all assignments and update the status of the specified assignment, then re-render the table and stats.

    const assignments = getAssignments();
    assignments[idx].status = status;
    saveAssignments(assignments);
    renderStats(assignments);
    renderAssignments(assignments);
    showNotification('Assignment status updated!', { icon: 'check' });
}

// Filter assignments based on search, module, and status filters

function filterAssignments() {

    // Get filter values and filter the assignments accordingly, then re-render the table with the filtered results.

    const search = document.getElementById('searchInput').value.toLowerCase();
    const module = document.getElementById('moduleFilter').value;
    const status = document.getElementById('statusFilter').value;
    let assignments = getAssignments();
    
    // Filter assignments based on user input in the search box and selected module/status filters. This allows users to quickly find specific assignments or narrow down the list to what they need to focus on.

    assignments = assignments.filter(a => {
        const matchesSearch = a.name.toLowerCase().includes(search);
        const matchesModule = !module || a.module === module;
        const matchesStatus = !status || a.status === status;
        return matchesSearch && matchesModule && matchesStatus;
    });
    renderAssignments(assignments);
}

document.getElementById('searchInput').addEventListener('input', filterAssignments);
document.getElementById('moduleFilter').addEventListener('change', filterAssignments);
document.getElementById('statusFilter').addEventListener('change', filterAssignments);

// Initial render: load assignments and display stats and table on page load.

const assignments = getAssignments();
renderStats(assignments);
renderAssignments(assignments);

// Show save/update notification if redirected from add-Assignment.html after saving or updating an assignment.

const assignmentStatus = sessionStorage.getItem('assignmentStatus');
if (assignmentStatus === 'saved') {
    showNotification('Assignment saved!', { icon: 'check' });
    sessionStorage.removeItem('assignmentStatus');
} else if (assignmentStatus === 'updated') {
    showNotification('Assignment updated!', { icon: 'check' });
    sessionStorage.removeItem('assignmentStatus');
}

// Delete assignment logic

// Handles row selection and deleting an assignment from the list when the delete button is clicked. It confirms the deletion with the user, updates localStorage, and re-renders the table and stats.

let selectedAssignmentIdx = null;
const assignmentTable = document.getElementById('assignmentTable');
const deleteBtn = document.getElementById('deleteAssignmentBtn');

function clearRowSelection() {
    document.querySelectorAll('.assignment-row.selected').forEach(row => row.classList.remove('selected'));
    selectedAssignmentIdx = null;
    if (deleteBtn) deleteBtn.disabled = true;
}

assignmentTable.addEventListener('click', function(e) {
    let row = e.target.closest('.assignment-row');
    if (!row) return;
    clearRowSelection();
    row.classList.add('selected');
    selectedAssignmentIdx = parseInt(row.getAttribute('data-idx'));
    if (deleteBtn) deleteBtn.disabled = false;
});

if (deleteBtn) {
    deleteBtn.addEventListener('click', function() {
        if (selectedAssignmentIdx === null) return;
        let assignments = getAssignments();
        if (assignments[selectedAssignmentIdx]) {
            if (confirm('Are you sure you want to delete this assignment?')) {
                assignments.splice(selectedAssignmentIdx, 1);
                saveAssignments(assignments);
                renderStats(assignments);
                renderAssignments(assignments);
                clearRowSelection();
                showNotification('Assignment deleted!', { icon: 'check' });
            }
        }
    });
}
</script>
<script>

// Dark mode toggle logic with sun/moon icons

// This section enables the user to switch between light and dark themes.

// The sun icon is shown in light mode, and the moon icon in dark mode.

// Smooth transition for theme toggle

const darkModeToggle = document.getElementById('darkModeToggle');
const sunIcon = document.getElementById('sunIcon');
const moonIcon = document.getElementById('moonIcon');
function setDarkMode(on) {
    
    // Add smooth transition for background and color when toggling dark mode, and switch the visibility of sun and moon icons accordingly. The user's preference is saved in localStorage so it persists across sessions.

    document.body.style.transition = 'background 3s, color 1s';
    document.documentElement.classList.toggle('dark-mode', on);
    if (on) {
        sunIcon.style.display = 'none';
        moonIcon.style.display = 'block';
    } else {
        sunIcon.style.display = 'block';
        moonIcon.style.display = 'none';
    }
    localStorage.setItem('darkMode', on ? '1' : '0');
}
const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
const saved = localStorage.getItem('darkMode');
const dark = saved === null ? prefersDark : saved === '1';
setDarkMode(dark);
darkModeToggle.addEventListener('click', () => {
    setDarkMode(!document.documentElement.classList.contains('dark-mode'));
});
</script>

</body>
</html>
